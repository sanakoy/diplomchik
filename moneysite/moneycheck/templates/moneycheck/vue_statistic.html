<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Статистика</title>
    {% load static %}
    <link type="text/css" href="{% static 'css/style.css' %}" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/flexboxgrid2@7.2.1/flexboxgrid2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.8/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<!--    <script src="https://cdnjs.cloudflare.com/ajax/libs/vuejs-datepicker/1.6.2/vuejs-datepicker.min.js" integrity="sha512-SxUBqfNhPSntua7WUkt171HWx4SV4xoRm14vLNsdDR/kQiMn8iMUeopr8VahPpuvRjQKeOiMJTJFH5NHzNUHYQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment-timezone@0.5.34/builds/moment-timezone-with-data.min.js"></script>

</head>
<body>
    <div class="rectangle">
        <div class="container">
            <div class="navbar">
                <div class="nav-left">
                    <a href="{% url menu.spending.slug %}">Расходы</a>
                    <a href="{% url menu.profit.slug %}">Доходы</a>
                    <a href="{% url menu.statistic.url_name menu.statistic.operation menu.statistic.year menu.statistic.month %}">Статистика</a>
                </div>
                <div class="nav-right">
                    <a href="{% url menu.profile.url_name %}">Профиль</a>
                    <a href="{% url menu.logout.url_name %}">Выйти</a>
                </div>
            </div>
        </div>
    </div>

    {% verbatim %}
    <div id="statistic">
        <div class="container container1">
            <div class="history">
                <div class="year-month">
                    <div v-for="(months, year) in sortedMonthsYear" class="year">
                        <div>{{ year }}:</div>
                        <div v-for="month in months" class="month">
                            <a :href="`${host}/statistic/spending/${parseInt(year)}/${parseInt(month)}`">{{ month }}</a>
                        </div>
                    </div>
                </div>
                <div class="operations">
                    <div class="total">
                        <h1>{{ operation_rus }}</h1>
                        <h2>{{ total }} ₽</h2>
                    </div>
                    <div v-for="(operations, day) in grouped_operation">
                        <h3>{{ day }}:</h3>
                        <div v-for="operation in operations" class="operation">
                            <div class="cat-image-comment-container">
                                <img :src="operation.image_url" width="60px" height="60px">
                                <div class="cat-comment">
                                    <div class="cat">{{ operation.kod_cat }}</div>
                                    <div class="comment">{{ operation.comment }}</div>
                                </div>
                            </div>
                            <div class="button-sum-container">
                                <div class="op-sum">{{ operation.sum }} ₽</div>
                                <div class="ed-plan-window">
                                    <button @click="submitDelOp(operation.id)">
                                        <img src="/static/cat_images/delete.svg" width="20px">
                                    </button>
                                    <button @click="openModalEdOp(operation.id, operation.sum, operation.comment)">
                                        <img src="/static/cat_images/edit.svg" width="21px">
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div v-if="showEdOp" class="modal">
                <div class="modal-window">
                    <div class="ed-cat">
                        <h1>Редактирование операции</h1>
                        <button @click="closeModalEdOp" class="btn-close-calc">
                            <img src="/static/cat_images/close.svg">
                        </button>
                    </div>
                    <div class="grid">
                        <input type="text" placeholder="Заметка..." v-model="opComment">
                        <input @keyup.enter="calc" type="text" placeholder="0" v-model="opSum">
                        <button class="cell op" @click="del">Del</button>
                        <button class="cell num" @click='input(num)' v-for="num in numbers">{{ num }}</button>
                        <button class="cell op" @click="input(op)" v-for="op in operations">{{ op }}</button>
                        <button class="cell op" @click="reset">R</button>
                        <button class="cell op" @click="calc">=</button>
                        <button class="cell op" @click="submitEdOp">Ок</button>
                    </div>
                    <div id="app">
<!--                        <datepicker v-model="selectedDate"></datepicker>-->
<!--                        <button @click="submitDate">Submit</button>-->
                        <input type="datetime-local" v-model="selectedDate"/>
                    </div>
                </div>
                <div class="overlay"></div>
            </div>
            <div>
                <div class="chart">
                    <canvas id="pieChart" width="100" height="100"></canvas>
                </div>
                <div v-if="operation == 'profit'" class="link-op">
                    <a :href="`${host}/statistic/spending/${parseInt(current_year)}/${parseInt(current_month)}`">Посмотреть расходы</a>
                </div>
                <div v-if="operation == 'spending'" class="link-op">
                    <a :href="`${host}/statistic/profit/${parseInt(current_year)}/${parseInt(current_month)}`">Посмотреть доходы</a>
                </div>
            </div>
        </div>
    </div>
    {% endverbatim %}

    <script src="/static/statistic.js"></script>
</body>
</html>
